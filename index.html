<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Pemanasan Membaca Suku Kata</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    /* --- Custom Styles for Kid-Friendly UI --- */
    body {
      font-family: 'Fredoka', sans-serif;
      overscroll-behavior-y: none; /* Prevent pull-to-refresh on mobile */
    }
    
    /* Smooth Pop Animation */
    @keyframes pop-in {
      0% { transform: scale(0.8); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    
    .card-enter {
      animation: pop-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }

    /* 3D Button/Card Effect */
    .btn-3d {
      transition: all 0.1s;
      border-bottom: 4px solid rgba(0,0,0,0.15);
    }
    .btn-3d:active {
      transform: translateY(4px);
      border-bottom: 0px solid rgba(0,0,0,0.15);
    }

    /* Specific Colors per state */
    .card-unread {
      background: white;
      border: 2px solid #e5e7eb;
      border-bottom: 6px solid #e5e7eb;
    }
    .card-read {
      background: #dcfce7; /* green-100 */
      border: 2px solid #22c55e; /* green-500 */
      border-bottom: 6px solid #15803d; /* green-700 */
    }

    /* Scrollbar hide */
    .hide-scrollbar::-webkit-scrollbar {
      display: none;
    }
    .hide-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full m-0 p-0 overflow-hidden bg-amber-50">
  
  <div id="app" class="w-full h-full flex flex-col max-w-4xl mx-auto bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]">
    
    <header class="pt-6 pb-2 px-4 text-center shrink-0 z-10">
      <h1 id="main-title" class="text-3xl md:text-4xl font-bold text-purple-600 drop-shadow-sm tracking-wide mb-1">
        ğŸˆ Ayo Membaca!
      </h1>
      <p id="instruction" class="text-slate-500 text-sm font-medium bg-white/80 inline-block px-3 py-1 rounded-full backdrop-blur-sm border border-slate-200">
        Tap kartu untuk mendengar suaranya ğŸ”Š
      </p>
    </header>

    <div class="px-4 py-2 shrink-0">
      <div class="flex gap-2 overflow-x-auto hide-scrollbar pb-2" id="category-container">
        </div>
    </div>

    <div class="px-6 py-1 shrink-0">
      <div class="flex justify-between items-end mb-1">
        <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">Level Ini</span>
        <span id="progress-text" class="text-sm font-bold text-purple-600">0/12</span>
      </div>
      <div class="h-4 w-full bg-slate-200 rounded-full overflow-hidden shadow-inner">
        <div id="progress-bar" class="h-full bg-gradient-to-r from-yellow-400 via-orange-400 to-red-500 w-0 transition-all duration-500 ease-out rounded-full"></div>
      </div>
    </div>

    <div class="flex-1 overflow-y-auto p-4" id="scroll-area">
      <div id="cards-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 pb-20">
        </div>
      
      <div id="pagination-controls" class="flex justify-center gap-4 mt-6 mb-8 hidden">
         <button onclick="changePage(-1)" class="btn-3d px-6 py-2 bg-slate-200 text-slate-600 rounded-xl font-bold">â¬…ï¸ Sebelumnya</button>
         <button onclick="changePage(1)" class="btn-3d px-6 py-2 bg-purple-500 text-white rounded-xl font-bold">Selanjutnya â¡ï¸</button>
      </div>
    </div>

    <div class="p-4 bg-white/90 backdrop-blur-md border-t border-slate-200 shrink-0 shadow-[0_-4px_20px_rgba(0,0,0,0.05)] rounded-t-3xl z-20">
      <div class="flex gap-3">
        <button onclick="shuffleAndReset()" class="btn-3d flex-1 py-3 bg-cyan-500 text-white font-bold rounded-2xl shadow-sm text-lg flex items-center justify-center gap-2">
          ğŸ² Acak
        </button>
        <button onclick="resetCurrentPage()" class="btn-3d w-16 py-3 bg-orange-400 text-white font-bold rounded-2xl shadow-sm flex items-center justify-center">
          ğŸ”„
        </button>
      </div>
    </div>

    <div id="mascot-container" class="fixed bottom-24 right-4 pointer-events-none z-30 transition-transform duration-300">
      <div class="text-6xl filter drop-shadow-xl animate-bounce" id="mascot-emoji">ğŸ»</div>
    </div>

    <div id="celebration" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 hidden transition-opacity duration-300 opacity-0">
      <div class="bg-white rounded-3xl p-8 text-center max-w-sm mx-4 shadow-2xl transform scale-90 transition-transform duration-300" id="celebration-content">
        <div class="text-8xl mb-4 animate-pulse">ğŸŒŸ</div>
        <h2 class="text-3xl font-bold text-purple-600 mb-2">Luar Biasa!</h2>
        <p class="text-slate-500 mb-6 text-lg">Kamu menyelesaikan halaman ini!</p>
        <button onclick="closeCelebration()" class="w-full btn-3d py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold rounded-2xl text-xl shadow-lg">
          Lanjut Main! ğŸš€
        </button>
      </div>
    </div>

  </div>

  <script>
    // --- CONFIGURATION & DATA ---
    const CONFIG = {
      itemsPerPage: 12, // LIMIT kartu agar tidak pusing
      speakRate: 0.8,
      speakPitch: 1.1
    };

    // Data Suku Kata Lengkap
    const SYLLABLE_DATA = {
      'konsonan-vokal': [
        { text: 'ba', emoji: 'ğŸŒ', word: 'baju' }, { text: 'be', emoji: 'ğŸ»', word: 'beruang' }, { text: 'bi', emoji: 'ğŸ’«', word: 'biru' }, { text: 'bo', emoji: 'âš½', word: 'bola' }, { text: 'bu', emoji: 'ğŸŒ™', word: 'buku' },
        { text: 'ca', emoji: 'ğŸ›', word: 'cacing' }, { text: 'ce', emoji: 'ğŸ¥¤', word: 'ceret' }, { text: 'ci', emoji: 'ğŸ’‹', word: 'cium' }, { text: 'co', emoji: 'ğŸ«', word: 'coklat' }, { text: 'cu', emoji: 'ğŸ§¼', word: 'cuci' },
        { text: 'da', emoji: 'ğŸ²', word: 'dadu' }, { text: 'de', emoji: 'ğŸ’—', word: 'dekat' }, { text: 'di', emoji: 'ğŸ§±', word: 'dinding' }, { text: 'do', emoji: 'ğŸ™', word: 'doa' }, { text: 'du', emoji: 'ğŸŒµ', word: 'duri' },
        { text: 'ga', emoji: 'ğŸ˜', word: 'gajah' }, { text: 'ge', emoji: 'â›ª', word: 'gereja' }, { text: 'gi', emoji: 'ğŸ¦·', word: 'gigi' }, { text: 'go', emoji: 'ğŸ¥', word: 'gong' }, { text: 'gu', emoji: 'â›°ï¸', word: 'gunung' },
        { text: 'ha', emoji: 'ğŸ¯', word: 'harimau' }, { text: 'he', emoji: 'ğŸ‘', word: 'hebat' }, { text: 'hi', emoji: 'ğŸŸ¢', word: 'hijau' }, { text: 'ho', emoji: 'ğŸ…', word: 'hobi' }, { text: 'hu', emoji: 'ğŸŒ²', word: 'hutan' },
        { text: 'ja', emoji: 'â°', word: 'jam' }, { text: 'je', emoji: 'ğŸªŸ', word: 'jendela' }, { text: 'ji', emoji: 'ğŸ§¡', word: 'jingga' }, { text: 'jo', emoji: 'ğŸ‘', word: 'jomblo' }, { text: 'ju', emoji: 'ğŸª', word: 'jual' },
        { text: 'ka', emoji: 'ğŸ¦¶', word: 'kaki' }, { text: 'ke', emoji: 'ğŸ§€', word: 'keju' }, { text: 'ki', emoji: 'â¬…ï¸', word: 'kiri' }, { text: 'ko', emoji: 'ğŸ“¦', word: 'kotak' }, { text: 'ku', emoji: 'ğŸ±', word: 'kucing' },
        { text: 'la', emoji: 'ğŸŒŠ', word: 'laut' }, { text: 'le', emoji: 'ğŸ†', word: 'leopard' }, { text: 'li', emoji: 'ğŸ•¯ï¸', word: 'lilin' }, { text: 'lo', emoji: 'ğŸªŸ', word: 'lobang' }, { text: 'lu', emoji: 'ğŸ¦œ', word: 'lucu' },
        { text: 'ma', emoji: 'ğŸ‘ï¸', word: 'mata' }, { text: 'me', emoji: 'ğŸ‰', word: 'melon' }, { text: 'mi', emoji: 'ğŸœ', word: 'mie' }, { text: 'mo', emoji: 'ğŸš—', word: 'mobil' }, { text: 'mu', emoji: 'ğŸ‘„', word: 'mulut' },
        { text: 'na', emoji: 'ğŸš', word: 'nasi' }, { text: 'ne', emoji: 'ğŸ‘µ', word: 'nenek' }, { text: 'ni', emoji: 'ğŸ’', word: 'nikah' }, { text: 'no', emoji: 'ğŸ”¢', word: 'nomor' }, { text: 'nu', emoji: 'ğŸ¥¥', word: 'nyiur' },
        { text: 'pa', emoji: 'ğŸ ', word: 'pagar' }, { text: 'pe', emoji: 'âœï¸', word: 'pensil' }, { text: 'pi', emoji: 'ğŸ”ª', word: 'pisau' }, { text: 'po', emoji: 'ğŸŒ³', word: 'pohon' }, { text: 'pu', emoji: 'ğŸ‘¸', word: 'putri' },
        { text: 'ra', emoji: 'ğŸ‘‘', word: 'raja' }, { text: 're', emoji: 'ğŸ¤', word: 'rekan' }, { text: 'ri', emoji: 'ğŸ¦', word: 'riang' }, { text: 'ro', emoji: 'ğŸ', word: 'roti' }, { text: 'ru', emoji: 'ğŸ ', word: 'rumah' },
        { text: 'sa', emoji: 'ğŸ„', word: 'sapi' }, { text: 'se', emoji: 'ğŸ‘Ÿ', word: 'sepatu' }, { text: 'si', emoji: 'ğŸª¥', word: 'sikat' }, { text: 'so', emoji: 'ğŸ¥¤', word: 'soda' }, { text: 'su', emoji: 'ğŸ¥›', word: 'susu' },
        { text: 'ta', emoji: 'ğŸ–ï¸', word: 'tangan' }, { text: 'te', emoji: 'ğŸ¥š', word: 'telur' }, { text: 'ti', emoji: 'ğŸ“º', word: 'tivi' }, { text: 'to', emoji: 'ğŸ…', word: 'tomat' }, { text: 'tu', emoji: 'ğŸ¦´', word: 'tulang' },
        { text: 'wa', emoji: 'ğŸ¨', word: 'warna' }, { text: 'we', emoji: 'ğŸƒ', word: 'wewangian' }, { text: 'wi', emoji: 'ğŸ“', word: 'wisuda' }, { text: 'wo', emoji: 'ğŸ§”', word: 'wolu' }, { text: 'wu', emoji: 'ğŸ”ï¸', word: 'wulung' },
        { text: 'ya', emoji: 'âœ…', word: 'ya' }, { text: 'ye', emoji: 'ğŸ‘', word: 'yel' }, { text: 'yi', emoji: 'ğŸ¯', word: 'yin' }, { text: 'yo', emoji: 'ğŸ¤', word: 'yoyo' }, { text: 'yu', emoji: 'ğŸš¶', word: 'yuk' },
        { text: 'za', emoji: 'ğŸ’', word: 'zaman' }, { text: 'ze', emoji: 'ğŸ¦“', word: 'zebra' }, { text: 'zi', emoji: 'ğŸ’', word: 'ziarah' }, { text: 'zo', emoji: 'ğŸ¦', word: 'zoo' }, { text: 'zu', emoji: 'ğŸ§¬', word: 'zulu' }
      ],
      'vokal-konsonan': [
        { text: 'an', emoji: 'ğŸ•', word: 'anjing' }, { text: 'en', emoji: 'ğŸ˜‹', word: 'enak' }, { text: 'in', emoji: 'ğŸ’', word: 'intan' }, { text: 'on', emoji: 'ğŸ”›', word: 'ondel' }, { text: 'un', emoji: 'ğŸ’œ', word: 'ungu' },
        { text: 'ang', emoji: 'ğŸ’¨', word: 'angin' }, { text: 'eng', emoji: 'ğŸ¯', word: 'engkau' }, { text: 'ing', emoji: 'ğŸ', word: 'eling' }, { text: 'ong', emoji: 'ğŸ¦', word: 'gorila' }, { text: 'ung', emoji: 'ğŸŸ£', word: 'ungu' },
        { text: 'ar', emoji: 'ğŸ¦…', word: 'arah' }, { text: 'er', emoji: 'ğŸ§±', word: 'ember' }, { text: 'ir', emoji: 'ğŸ’§', word: 'air' }, { text: 'or', emoji: 'ğŸº', word: 'orkes' }, { text: 'ur', emoji: 'âœ¨', word: 'huruf' },
        { text: 'ak', emoji: 'ğŸ‘¶', word: 'anak' }, { text: 'ek', emoji: 'ğŸ‘‚', word: 'ekor' }, { text: 'ik', emoji: 'ğŸŸ', word: 'ikan' }, { text: 'ok', emoji: 'ğŸ‘Œ', word: 'tokoh' }, { text: 'uk', emoji: 'ğŸ“–', word: 'buku' },
        { text: 'al', emoji: 'ğŸ”¥', word: 'amal' }, { text: 'el', emoji: 'ğŸ¸', word: 'gelas' }, { text: 'il', emoji: 'ğŸ§ª', word: 'ilmu' }, { text: 'ol', emoji: 'âš½', word: 'bola' }, { text: 'ul', emoji: 'ğŸ›', word: 'ulat' },
        { text: 'am', emoji: 'ğŸ•', word: 'aman' }, { text: 'em', emoji: 'ğŸ¥‡', word: 'emas' }, { text: 'im', emoji: 'ğŸŒŸ', word: 'impian' }, { text: 'om', emoji: 'ğŸ‘¨', word: 'om' }, { text: 'um', emoji: 'ğŸ ', word: 'umum' },
        { text: 'as', emoji: 'ğŸ’¨', word: 'asap' }, { text: 'es', emoji: 'ğŸ§Š', word: 'es' }, { text: 'is', emoji: 'ğŸ“‹', word: 'isi' }, { text: 'os', emoji: 'ğŸ’€', word: 'fosil' }, { text: 'us', emoji: 'ğŸšŒ', word: 'bus' },
        { text: 'at', emoji: 'ğŸ‹ï¸', word: 'berat' }, { text: 'et', emoji: 'ğŸ«', word: 'tiket' }, { text: 'it', emoji: 'ğŸ¦†', word: 'bebek' }, { text: 'ot', emoji: 'ğŸš—', word: 'motor' }, { text: 'ut', emoji: 'ğŸª¢', word: 'ikut' },
        { text: 'ap', emoji: 'ğŸ”¥', word: 'api' }, { text: 'ep', emoji: 'ğŸš¶', word: 'sepeda' }, { text: 'ip', emoji: 'ğŸ’¤', word: 'tipis' }, { text: 'op', emoji: 'ğŸª', word: 'toko' }, { text: 'up', emoji: 'ğŸˆ', word: 'upacara' }
      ],
      'konsonan-vokal-konsonan': [
        { text: 'bak', emoji: 'ğŸ›', word: 'bak' }, { text: 'ban', emoji: 'ğŸ›', word: 'ban' }, { text: 'bas', emoji: 'ğŸšŒ', word: 'bas' }, { text: 'bel', emoji: 'ğŸ””', word: 'bel' }, { text: 'bis', emoji: 'ğŸš', word: 'bis' },
        { text: 'bok', emoji: 'ğŸ“¦', word: 'box' }, { text: 'bom', emoji: 'ğŸ’£', word: 'bom' }, { text: 'bor', emoji: 'ğŸ”¨', word: 'bor' }, { text: 'bus', emoji: 'ğŸšŒ', word: 'bus' }, { text: 'but', emoji: 'ğŸ£', word: 'but' },
        { text: 'cap', emoji: 'ğŸ‘†', word: 'cap' }, { text: 'cat', emoji: 'ğŸ¨', word: 'cat' }, { text: 'cek', emoji: 'âœ…', word: 'cek' }, { text: 'cin', emoji: 'ğŸ’', word: 'cincin' }, { text: 'cop', emoji: 'ğŸ¥¤', word: 'cop' },
        { text: 'dam', emoji: 'ğŸ¯', word: 'dam' }, { text: 'dan', emoji: 'â•', word: 'dan' }, { text: 'dem', emoji: 'ğŸ¤’', word: 'demam' }, { text: 'din', emoji: 'â„ï¸', word: 'dingin' }, { text: 'dok', emoji: 'ğŸ‘¨â€âš•ï¸', word: 'dokter' },
        { text: 'gam', emoji: 'ğŸ–¼ï¸', word: 'gambar' }, { text: 'gas', emoji: 'â›½', word: 'gas' }, { text: 'gel', emoji: 'ğŸ’‡', word: 'gel' }, { text: 'gol', emoji: 'âš½', word: 'gol' }, { text: 'guk', emoji: 'ğŸ•', word: 'guk' },
        { text: 'hal', emoji: 'ğŸ“„', word: 'halaman' }, { text: 'ham', emoji: 'ğŸ¹', word: 'hamster' }, { text: 'hat', emoji: 'â¤ï¸', word: 'hati' }, { text: 'him', emoji: 'ğŸµ', word: 'himne' }, { text: 'hit', emoji: 'âš«', word: 'hitam' },
        { text: 'jak', emoji: 'ğŸ§¥', word: 'jaket' }, { text: 'jam', emoji: 'â°', word: 'jam' }, { text: 'jat', emoji: 'ğŸ‚', word: 'jatuh' }, { text: 'jip', emoji: 'ğŸš™', word: 'jip' }, { text: 'jok', emoji: 'ğŸ’º', word: 'jok' },
        { text: 'kak', emoji: 'ğŸ‘§', word: 'kakak' }, { text: 'kal', emoji: 'ğŸ§®', word: 'kalkulator' }, { text: 'kam', emoji: 'ğŸ•ï¸', word: 'kamp' }, { text: 'kan', emoji: 'ğŸŸ', word: 'ikan' }, { text: 'kas', emoji: 'ğŸ’°', word: 'kas' },
        { text: 'lam', emoji: 'ğŸ’¡', word: 'lampu' }, { text: 'lan', emoji: 'ğŸ›£ï¸', word: 'jalan' }, { text: 'lap', emoji: 'ğŸ§¹', word: 'lap' }, { text: 'las', emoji: 'âš¡', word: 'las' }, { text: 'lat', emoji: 'ğŸƒ', word: 'lat' },
        { text: 'mak', emoji: 'ğŸ‘©', word: 'mama' }, { text: 'mal', emoji: 'ğŸ›’', word: 'mal' }, { text: 'mam', emoji: 'ğŸ²', word: 'makan' }, { text: 'man', emoji: 'ğŸ§”', word: 'paman' }, { text: 'map', emoji: 'ğŸ“', word: 'map' },
        { text: 'nak', emoji: 'ğŸ‘¶', word: 'anak' }, { text: 'nam', emoji: '6ï¸âƒ£', word: 'enam' }, { text: 'nan', emoji: 'ğŸ', word: 'nanas' }, { text: 'nek', emoji: 'ğŸ‘µ', word: 'nenek' }, { text: 'net', emoji: 'ğŸ¾', word: 'net' },
        { text: 'pak', emoji: 'ğŸ‘¨', word: 'bapak' }, { text: 'pan', emoji: 'ğŸ³', word: 'panci' }, { text: 'pas', emoji: 'ğŸ¯', word: 'pas' }, { text: 'pat', emoji: '4ï¸âƒ£', word: 'empat' }, { text: 'pel', emoji: 'ğŸ§¹', word: 'pel' },
        { text: 'rak', emoji: 'ğŸ—„ï¸', word: 'rak' }, { text: 'ram', emoji: 'ğŸ', word: 'domba' }, { text: 'ran', emoji: 'ğŸ’', word: 'ransel' }, { text: 'rap', emoji: 'ğŸ¤', word: 'rap' }, { text: 'rat', emoji: 'ğŸ­', word: 'tikus' },
        { text: 'sak', emoji: 'ğŸ’°', word: 'saku' }, { text: 'sal', emoji: 'ğŸ§£', word: 'syal' }, { text: 'sam', emoji: 'ğŸ—‘ï¸', word: 'sampah' }, { text: 'san', emoji: 'ğŸ–ï¸', word: 'pasir' }, { text: 'sap', emoji: 'ğŸ§¹', word: 'sapu' },
        { text: 'tak', emoji: 'ğŸ§ ', word: 'otak' }, { text: 'tal', emoji: 'ğŸ§¶', word: 'tali' }, { text: 'tam', emoji: 'ğŸŒ³', word: 'taman' }, { text: 'tan', emoji: 'ğŸŒ±', word: 'tanah' }, { text: 'tap', emoji: 'ğŸ‘£', word: 'tap' },
        { text: 'wak', emoji: 'â°', word: 'waktu' }, { text: 'wan', emoji: 'â˜ï¸', word: 'awan' }, { text: 'wat', emoji: 'ğŸ’¡', word: 'watt' }, { text: 'web', emoji: 'ğŸŒ', word: 'web' }, { text: 'wet', emoji: 'ğŸ’¦', word: 'awet' }
      ],
      'diftong': [
        { text: 'ai', emoji: 'ğŸ’§', word: 'air' }, { text: 'au', emoji: 'ğŸƒ', word: 'kerbau' }, { text: 'oi', emoji: 'ğŸ‘‹', word: 'amboi' }, { text: 'ei', emoji: 'ğŸ¯', word: 'survei' },
        { text: 'nya', emoji: 'ğŸ±', word: 'kucingnya' }, { text: 'nga', emoji: 'ğŸ‘„', word: 'nganga' }, { text: 'nge', emoji: 'ğŸ¢', word: 'ngebut' }, { text: 'ngi', emoji: 'ğŸŒˆ', word: 'pelangi' }, { text: 'ngo', emoji: 'ğŸ—£ï¸', word: 'ngomel' },
        { text: 'kha', emoji: 'ğŸ‘³', word: 'khusus' }, { text: 'khi', emoji: 'â›ª', word: 'akhir' }, { text: 'sya', emoji: 'ğŸ§£', word: 'syal' }, { text: 'syu', emoji: 'ğŸ™', word: 'syukur' }
      ]
    };

    // --- APP STATE ---
    let state = {
      activeCategory: 'semua',
      allCards: [],
      currentCards: [],
      readCards: new Set(),
      currentPage: 0,
      totalPages: 0,
      audioCtx: null
    };

    const categories = [
      { id: 'semua', label: 'ğŸŒŸ Semua', color: 'from-purple-500 to-indigo-500' },
      { id: 'konsonan-vokal', label: 'ğŸ…°ï¸ Ba-Bi-Bu', color: 'from-blue-400 to-cyan-400' },
      { id: 'vokal-konsonan', label: 'ğŸ”¤ An-In-Un', color: 'from-green-400 to-emerald-500' },
      { id: 'konsonan-vokal-konsonan', label: 'ğŸ“š Bak-Bis', color: 'from-orange-400 to-amber-500' },
      { id: 'diftong', label: 'ğŸµ Ai-Au-Nya', color: 'from-pink-500 to-rose-500' }
    ];

    // --- INITIALIZATION ---
    function init() {
      // Setup Categories
      const catContainer = document.getElementById('category-container');
      catContainer.innerHTML = categories.map(cat => `
        <button onclick="setCategory('${cat.id}')" 
          id="btn-${cat.id}"
          class="cat-btn flex-shrink-0 px-4 py-2 rounded-xl text-sm font-bold transition-all active:scale-95 border-b-4 border-transparent
          ${cat.id === 'semua' ? `bg-gradient-to-r ${cat.color} text-white border-black/20` : 'bg-white text-slate-500 border-slate-200'}">
          ${cat.label}
        </button>
      `).join('');

      loadCategory('semua');
      
      // Init Audio Context for SFX on first interaction
      document.body.addEventListener('click', initAudio, { once: true });
    }

    function initAudio() {
      if (!state.audioCtx) {
        state.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
    }

    // --- LOGIC ---

    function getCombinedData() {
      return Object.values(SYLLABLE_DATA).flat();
    }

    function loadCategory(catId) {
      state.activeCategory = catId;
      state.readCards.clear();
      state.currentPage = 0;

      // Update Buttons UI
      categories.forEach(cat => {
        const btn = document.getElementById(`btn-${cat.id}`);
        if (cat.id === catId) {
          btn.className = `cat-btn flex-shrink-0 px-4 py-2 rounded-xl text-sm font-bold transition-all transform scale-105 active:scale-95 border-b-4 border-black/20 bg-gradient-to-r ${cat.color} text-white shadow-lg`;
        } else {
          btn.className = `cat-btn flex-shrink-0 px-4 py-2 rounded-xl text-sm font-bold transition-all active:scale-95 border-b-4 border-slate-200 bg-white text-slate-500 hover:bg-slate-50`;
        }
      });

      // Fetch Data
      let data = catId === 'semua' ? getCombinedData() : (SYLLABLE_DATA[catId] || []);
      
      // Shuffle slightly for variety, but keep mostly ordered for learning
      if (catId === 'semua') {
         data = data.sort(() => Math.random() - 0.5);
      }
      
      state.allCards = data;
      state.totalPages = Math.ceil(data.length / CONFIG.itemsPerPage);
      
      renderPage();
    }

    function renderPage() {
      const start = state.currentPage * CONFIG.itemsPerPage;
      const end = start + CONFIG.itemsPerPage;
      state.currentCards = state.allCards.slice(start, end);

      const container = document.getElementById('cards-container');
      container.innerHTML = ''; // Clear

      state.currentCards.forEach((item, idx) => {
        const isRead = state.readCards.has(item.text);
        const card = document.createElement('button');
        card.id = `card-${idx}`;
        card.className = `relative aspect-square rounded-2xl flex flex-col items-center justify-center p-2 transition-all active:scale-95 cursor-pointer card-enter btn-3d ${isRead ? 'card-read' : 'card-unread'}`;
        card.style.animationDelay = `${idx * 0.05}s`;
        card.onclick = () => speakCard(item, idx);
        
        card.innerHTML = `
          <div class="text-4xl mb-2 filter drop-shadow-sm transition-transform duration-300 group-hover:scale-110">${item.emoji}</div>
          <div class="text-2xl md:text-3xl font-black text-slate-700 tracking-tight">${item.text}</div>
          ${isRead ? '<div class="absolute top-2 right-2 text-green-500 text-xl animate-bounce">âœ“</div>' : ''}
        `;
        container.appendChild(card);
      });

      updateUI();
    }

    function updateUI() {
      // Progress
      const pageTotal = state.currentCards.length;
      const pageDone = state.currentCards.filter(c => state.readCards.has(c.text)).length;
      const pct = pageTotal === 0 ? 0 : (pageDone / pageTotal) * 100;

      document.getElementById('progress-bar').style.width = `${pct}%`;
      document.getElementById('progress-text').textContent = `${pageDone}/${pageTotal}`;

      // Pagination Controls
      const pagEl = document.getElementById('pagination-controls');
      if (state.totalPages > 1) {
        pagEl.classList.remove('hidden');
        pagEl.children[0].disabled = state.currentPage === 0;
        pagEl.children[0].classList.toggle('opacity-50', state.currentPage === 0);
        
        pagEl.children[1].disabled = state.currentPage >= state.totalPages - 1;
        pagEl.children[1].classList.toggle('opacity-50', state.currentPage >= state.totalPages - 1);
      } else {
        pagEl.classList.add('hidden');
      }

      // Check Completion of Page
      if (pageDone === pageTotal && pageTotal > 0) {
        setTimeout(showCelebration, 500);
      }
    }

    function changePage(delta) {
      const newPage = state.currentPage + delta;
      if (newPage >= 0 && newPage < state.totalPages) {
        state.currentPage = newPage;
        // Reset read status for new page? No, keep global read status logic if wanted, 
        // but for this UX, let's treat pages as mini-levels.
        // We will clear read status visually for the new set unless we track global IDs.
        // For simplicity: Clear visuals for new random set.
        state.readCards.clear();
        renderPage();
        document.getElementById('scroll-area').scrollTop = 0;
      }
    }

    // --- AUDIO & INTERACTIONS ---

    function playSuccessSound() {
      if (!state.audioCtx) return;
      const osc = state.audioCtx.createOscillator();
      const gain = state.audioCtx.createGain();
      
      osc.connect(gain);
      gain.connect(state.audioCtx.destination);
      
      osc.type = 'sine';
      osc.frequency.setValueAtTime(500, state.audioCtx.currentTime);
      osc.frequency.exponentialRampToValueAtTime(1000, state.audioCtx.currentTime + 0.1);
      
      gain.gain.setValueAtTime(0.3, state.audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, state.audioCtx.currentTime + 0.3);
      
      osc.start();
      osc.stop(state.audioCtx.currentTime + 0.3);
    }

    function speakCard(item, idx) {
      // Visual feedback
      const card = document.getElementById(`card-${idx}`);
      card.classList.add('scale-95');
      setTimeout(() => card.classList.remove('scale-95'), 150);

      // Speak
      if ('speechSynthesis' in window) {
        speechSynthesis.cancel(); // Stop previous
        const utterance = new SpeechSynthesisUtterance(item.text);
        utterance.lang = 'id-ID';
        utterance.rate = CONFIG.speakRate;
        utterance.pitch = CONFIG.speakPitch;
        
        utterance.onend = () => {
          if (!state.readCards.has(item.text)) {
            state.readCards.add(item.text);
            playSuccessSound();
            
            // Visual Update
            card.className = card.className.replace('card-unread', 'card-read');
            card.innerHTML += '<div class="absolute top-2 right-2 text-green-500 text-xl animate-bounce">âœ“</div>';
            
            updateUI();
            updateMascot();
          }
        };
        
        speechSynthesis.speak(utterance);
      }
    }

    function shuffleAndReset() {
      state.allCards = state.allCards.sort(() => Math.random() - 0.5);
      state.readCards.clear();
      renderPage();
    }
    
    function resetCurrentPage() {
      state.readCards.clear();
      renderPage();
    }

    function updateMascot() {
      const emojis = ['ğŸ»', 'ğŸ¼', 'ğŸ¨', 'ğŸ¦', 'ğŸ¯'];
      const el = document.getElementById('mascot-emoji');
      el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
      
      // Jump animation
      const container = document.getElementById('mascot-container');
      container.style.transform = 'translateY(-20px) rotate(10deg)';
      setTimeout(() => {
        container.style.transform = 'translateY(0) rotate(0deg)';
      }, 300);
    }

    function showCelebration() {
      const modal = document.getElementById('celebration');
      const content = document.getElementById('celebration-content');
      modal.classList.remove('hidden');
      // Force reflow
      void modal.offsetWidth;
      modal.classList.remove('opacity-0');
      content.classList.remove('scale-90');
      
      // Play a little victory tune
      if(state.audioCtx) {
         // Simple arpeggio
         [440, 554, 659, 880].forEach((freq, i) => {
           setTimeout(() => {
             const osc = state.audioCtx.createOscillator();
             const gain = state.audioCtx.createGain();
             osc.connect(gain);
             gain.connect(state.audioCtx.destination);
             osc.frequency.value = freq;
             gain.gain.setValueAtTime(0.2, state.audioCtx.currentTime);
             gain.gain.exponentialRampToValueAtTime(0.01, state.audioCtx.currentTime + 0.3);
             osc.start();
             osc.stop(state.audioCtx.currentTime + 0.3);
           }, i * 150);
         });
      }
    }

    function closeCelebration() {
      const modal = document.getElementById('celebration');
      modal.classList.add('opacity-0');
      setTimeout(() => {
        modal.classList.add('hidden');
        if (state.currentPage < state.totalPages - 1) {
          changePage(1);
        } else {
          shuffleAndReset(); // Loop back if at end
        }
      }, 300);
    }

    // Run
    init();

  </script>
 </body>
</html>
