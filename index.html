<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Pemanasan Membaca Suku Kata</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    /* --- Styles --- */
    body {
      font-family: 'Fredoka', sans-serif;
      overscroll-behavior-y: none;
      user-select: none;
    }
    
    /* Animations */
    @keyframes pop-in {
      0% { transform: scale(0.8); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    @keyframes wiggle {
      0%, 100% { transform: rotate(-3deg); }
      50% { transform: rotate(3deg); }
    }
    .wiggle { animation: wiggle 0.3s ease-in-out infinite; }
    
    .card-enter { animation: pop-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

    /* 3D Button Effect */
    .btn-3d {
      transition: all 0.1s;
      border-bottom: 5px solid rgba(0,0,0,0.15);
      position: relative;
      top: 0;
    }
    .btn-3d:active {
      transform: translateY(5px);
      border-bottom: 0px solid rgba(0,0,0,0.15);
      margin-bottom: 5px; /* keep layout stable */
    }

    /* Card States */
    .card-normal { background: white; border: 2px solid #e5e7eb; border-bottom: 6px solid #e5e7eb; }
    .card-read { background: #dcfce7; border: 2px solid #22c55e; border-bottom: 6px solid #15803d; }
    .card-wrong { background: #fee2e2; border: 2px solid #ef4444; border-bottom: 6px solid #b91c1c; animation: wiggle 0.4s; }
    .card-correct { background: #d1fae5; border: 2px solid #10b981; border-bottom: 6px solid #047857; transform: scale(1.05); }

    /* Scrollbar hide */
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full m-0 p-0 overflow-hidden bg-amber-50">
  
  <div id="app" class="w-full h-full flex flex-col max-w-4xl mx-auto bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]">
    
    <header class="pt-4 pb-2 px-4 text-center shrink-0 z-20">
      <div class="bg-white/90 backdrop-blur rounded-3xl p-1.5 inline-flex shadow-sm border border-slate-200 mb-3">
        <button onclick="window.setMode('learn')" id="mode-learn" class="px-6 py-2 rounded-2xl text-sm font-bold transition-all bg-purple-500 text-white shadow-md">
          üìñ Belajar
        </button>
        <button onclick="window.setMode('quiz')" id="mode-quiz" class="px-6 py-2 rounded-2xl text-sm font-bold transition-all text-slate-500 hover:bg-slate-100">
          üéÆ Kuis
        </button>
      </div>
      
      <div id="instruction-bar" class="text-center">
        <p id="instruction" class="text-slate-500 text-sm font-medium bg-white/80 inline-block px-3 py-1 rounded-full border border-slate-200">
          Tap kartu untuk mendengar suaranya üîä
        </p>
      </div>
    </header>

    <div class="px-4 py-1 shrink-0 z-10">
      <div class="flex gap-2 overflow-x-auto hide-scrollbar pb-2" id="category-container">
        </div>
    </div>

    <div class="flex-1 overflow-y-auto p-4 relative" id="scroll-area">
      
      <div id="view-learn" class="transition-opacity duration-300">
        <div class="mb-4 px-2">
           <div class="flex justify-between items-end mb-1">
            <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">Progres</span>
            <span id="progress-text" class="text-sm font-bold text-purple-600">0/12</span>
          </div>
          <div class="h-3 w-full bg-slate-200 rounded-full overflow-hidden">
            <div id="progress-bar" class="h-full bg-gradient-to-r from-green-400 to-emerald-500 w-0 transition-all duration-500 rounded-full"></div>
          </div>
        </div>

        <div id="cards-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 pb-20">
          </div>
        
        <div id="pagination-controls" class="flex justify-center gap-4 mt-6 mb-8 hidden">
           <button onclick="window.changePage(-1)" class="btn-3d px-4 py-2 bg-slate-200 text-slate-600 rounded-xl font-bold text-sm">‚¨ÖÔ∏è</button>
           <button onclick="window.changePage(1)" class="btn-3d px-6 py-2 bg-purple-500 text-white rounded-xl font-bold text-sm">Halaman Berikutnya ‚û°Ô∏è</button>
        </div>
      </div>

      <div id="view-quiz" class="hidden flex flex-col items-center justify-center h-full pb-20">
        
        <div class="absolute top-0 right-4 bg-yellow-100 text-yellow-700 px-4 py-2 rounded-2xl font-bold border-2 border-yellow-300 shadow-sm">
          ‚≠êÔ∏è <span id="quiz-score">0</span>
        </div>

        <div class="mb-8 text-center animate-bounce-slow">
           <button onclick="window.replayQuizSound()" class="btn-3d w-24 h-24 rounded-full bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center shadow-xl active:scale-95">
             <span class="text-5xl">üîä</span>
           </button>
           <p class="mt-4 text-slate-500 font-medium">Dengarkan & Pilih!</p>
        </div>

        <div id="quiz-options" class="grid grid-cols-2 gap-4 w-full max-w-md">
          </div>

        <button id="btn-next-quiz" onclick="window.nextQuizQuestion()" class="mt-8 btn-3d px-8 py-3 bg-green-500 text-white font-bold rounded-2xl text-xl hidden shadow-lg animate-bounce">
          Lanjut! üöÄ
        </button>

      </div>
    </div>

    <div id="footer-learn" class="p-4 bg-white/90 backdrop-blur-md border-t border-slate-200 shrink-0 shadow-[0_-4px_20px_rgba(0,0,0,0.05)] rounded-t-3xl z-20">
      <div class="flex gap-3">
        <button onclick="window.shuffleAndReset()" class="btn-3d flex-1 py-3 bg-cyan-500 text-white font-bold rounded-2xl shadow-sm text-lg flex items-center justify-center gap-2">
          üé≤ Acak Kartu
        </button>
        <button onclick="window.resetCurrentPage()" class="btn-3d w-16 py-3 bg-orange-400 text-white font-bold rounded-2xl shadow-sm flex items-center justify-center">
          üîÑ
        </button>
      </div>
    </div>

    <div id="celebration" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 hidden transition-opacity duration-300 opacity-0">
      <div class="bg-white rounded-3xl p-8 text-center max-w-sm mx-4 shadow-2xl transform scale-90 transition-transform duration-300" id="celebration-content">
        <div class="text-8xl mb-4 animate-pulse">üéâ</div>
        <h2 class="text-3xl font-bold text-purple-600 mb-2">Hebat!</h2>
        <p id="celebration-text" class="text-slate-500 mb-6 text-lg">Kamu berhasil!</p>
        <button onclick="window.closeCelebration()" class="w-full btn-3d py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold rounded-2xl text-xl shadow-lg">
          Lanjut! üöÄ
        </button>
      </div>
    </div>

  </div>

  <script>
    // --- DATA ---
    const SYLLABLE_DATA = {
      'konsonan-vokal': [
        { text: 'ba', emoji: 'üçå' }, { text: 'be', emoji: 'üêª' }, { text: 'bi', emoji: 'üí´' }, { text: 'bo', emoji: '‚öΩ' }, { text: 'bu', emoji: 'üåô' },
        { text: 'ca', emoji: 'üêõ' }, { text: 'ce', emoji: 'ü•§' }, { text: 'ci', emoji: 'üíã' }, { text: 'co', emoji: 'üç´' }, { text: 'cu', emoji: 'üßº' },
        { text: 'da', emoji: 'üé≤' }, { text: 'de', emoji: 'üíó' }, { text: 'di', emoji: 'üß±' }, { text: 'do', emoji: 'üôè' }, { text: 'du', emoji: 'üåµ' },
        { text: 'ka', emoji: 'ü¶∂' }, { text: 'ke', emoji: 'üßÄ' }, { text: 'ki', emoji: '‚¨ÖÔ∏è' }, { text: 'ko', emoji: 'üì¶' }, { text: 'ku', emoji: 'üê±' },
        { text: 'ma', emoji: 'üëÅÔ∏è' }, { text: 'me', emoji: 'üçâ' }, { text: 'mi', emoji: 'üçú' }, { text: 'mo', emoji: 'üöó' }, { text: 'mu', emoji: 'üëÑ' },
        { text: 'na', emoji: 'üçö' }, { text: 'ne', emoji: 'üëµ' }, { text: 'ni', emoji: 'üíç' }, { text: 'no', emoji: 'üî¢' }, { text: 'nu', emoji: 'ü••' },
        { text: 'sa', emoji: 'üêÑ' }, { text: 'se', emoji: 'üëü' }, { text: 'si', emoji: 'ü™•' }, { text: 'so', emoji: 'ü•§' }, { text: 'su', emoji: 'ü•õ' },
        { text: 'ta', emoji: 'üñêÔ∏è' }, { text: 'te', emoji: 'ü•ö' }, { text: 'ti', emoji: 'üì∫' }, { text: 'to', emoji: 'üçÖ' }, { text: 'tu', emoji: 'ü¶¥' },
        { text: 'ya', emoji: '‚úÖ' }, { text: 'ye', emoji: 'üëç' }, { text: 'yi', emoji: 'üéØ' }, { text: 'yo', emoji: 'üé§' }, { text: 'yu', emoji: 'üö∂' }
      ],
      'vokal-konsonan': [
        { text: 'an', emoji: 'üêï' }, { text: 'en', emoji: 'üòã' }, { text: 'in', emoji: 'üíé' }, { text: 'on', emoji: 'üîõ' }, { text: 'un', emoji: 'üíú' },
        { text: 'ar', emoji: 'ü¶Ö' }, { text: 'er', emoji: 'üß±' }, { text: 'ir', emoji: 'üíß' }, { text: 'or', emoji: 'üé∫' }, { text: 'ur', emoji: '‚ú®' },
        { text: 'am', emoji: 'üïê' }, { text: 'em', emoji: 'ü•á' }, { text: 'im', emoji: 'üåü' }, { text: 'om', emoji: 'üë®' }, { text: 'um', emoji: 'üè†' }
      ],
      'konsonan-vokal-konsonan': [
        { text: 'bak', emoji: 'üõÅ' }, { text: 'ban', emoji: 'üõû' }, { text: 'bas', emoji: 'üöå' }, { text: 'bel', emoji: 'üîî' }, { text: 'bis', emoji: 'üöç' },
        { text: 'jam', emoji: '‚è∞' }, { text: 'jok', emoji: 'üí∫' }, { text: 'jus', emoji: 'üßÉ' },
        { text: 'kak', emoji: 'üëß' }, { text: 'kal', emoji: 'üßÆ' }, { text: 'kam', emoji: 'üèïÔ∏è' }, { text: 'kan', emoji: 'üêü' }, { text: 'kas', emoji: 'üí∞' },
        { text: 'lam', emoji: 'üí°' }, { text: 'lap', emoji: 'üßπ' }, { text: 'las', emoji: '‚ö°' },
        { text: 'mak', emoji: 'üë©' }, { text: 'mam', emoji: 'üç≤' }, { text: 'map', emoji: 'üìÅ' }, { text: 'mas', emoji: 'ü•á' }
      ],
      'diftong': [
        { text: 'ai', emoji: 'üíß' }, { text: 'au', emoji: 'üêÉ' }, { text: 'oi', emoji: 'üëã' }, { text: 'ei', emoji: 'üéØ' },
        { text: 'nya', emoji: 'üê±' }, { text: 'nga', emoji: 'üëÑ' }, { text: 'khi', emoji: '‚õ™' }, { text: 'syu', emoji: 'üôè' }
      ]
    };

    const CATEGORIES = [
      { id: 'semua', label: 'üåü Semua', color: 'from-purple-500 to-indigo-500' },
      { id: 'konsonan-vokal', label: 'üÖ∞Ô∏è Ba-Bi-Bu', color: 'from-blue-400 to-cyan-400' },
      { id: 'vokal-konsonan', label: 'üî§ An-In-Un', color: 'from-green-400 to-emerald-500' },
      { id: 'konsonan-vokal-konsonan', label: 'üìö Bak-Bis', color: 'from-orange-400 to-amber-500' },
      { id: 'diftong', label: 'üéµ Ai-Au', color: 'from-pink-500 to-rose-500' }
    ];

    // --- STATE ---
    let state = {
      mode: 'learn', // 'learn' or 'quiz'
      activeCategory: 'semua',
      allCards: [],
      currentCards: [], // For learn pagination
      readCards: new Set(),
      currentPage: 0,
      
      // Quiz State
      quizScore: 0,
      quizTarget: null,
      isQuizAnswered: false
    };

    // --- INIT ---
    function init() {
      // 1. Render Category Menu
      const catContainer = document.getElementById('category-container');
      catContainer.innerHTML = CATEGORIES.map(cat => `
        <button onclick="window.setCategory('${cat.id}')" 
          id="btn-${cat.id}"
          class="cat-btn flex-shrink-0 px-4 py-2 rounded-xl text-sm font-bold transition-all border-b-4 border-slate-200 bg-white text-slate-500">
          ${cat.label}
        </button>
      `).join('');

      // 2. Load Default
      window.setCategory('semua');
      
      // 3. Init Audio on first click
      document.body.addEventListener('click', initAudio, { once: true });
    }

    let audioCtx = null;
    function initAudio() {
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }

    // --- GLOBAL ACTIONS (Attached to Window) ---

    window.setMode = function(mode) {
      state.mode = mode;
      
      // UI Toggles
      document.getElementById('mode-learn').className = mode === 'learn' 
        ? "px-6 py-2 rounded-2xl text-sm font-bold transition-all bg-purple-500 text-white shadow-md"
        : "px-6 py-2 rounded-2xl text-sm font-bold transition-all text-slate-500 hover:bg-slate-100";
        
      document.getElementById('mode-quiz').className = mode === 'quiz'
        ? "px-6 py-2 rounded-2xl text-sm font-bold transition-all bg-purple-500 text-white shadow-md"
        : "px-6 py-2 rounded-2xl text-sm font-bold transition-all text-slate-500 hover:bg-slate-100";

      // View Swapping
      if (mode === 'learn') {
        document.getElementById('view-learn').classList.remove('hidden');
        document.getElementById('footer-learn').classList.remove('hidden');
        document.getElementById('view-quiz').classList.add('hidden');
        document.getElementById('instruction').textContent = "Tap kartu untuk mendengar suaranya üîä";
        renderLearnPage();
      } else {
        document.getElementById('view-learn').classList.add('hidden');
        document.getElementById('footer-learn').classList.add('hidden');
        document.getElementById('view-quiz').classList.remove('hidden');
        document.getElementById('instruction').textContent = "Dengarkan suara dan pilih kartu yang benar! üéØ";
        window.nextQuizQuestion();
      }
    };

    window.setCategory = function(catId) {
      state.activeCategory = catId;
      
      // Update Menu Styles
      CATEGORIES.forEach(cat => {
        const btn = document.getElementById(`btn-${cat.id}`);
        if (cat.id === catId) {
          btn.className = `cat-btn flex-shrink-0 px-4 py-2 rounded-xl text-sm font-bold transition-all border-b-4 border-black/20 bg-gradient-to-r ${cat.color} text-white transform scale-105`;
        } else {
          btn.className = `cat-btn flex-shrink-0 px-4 py-2 rounded-xl text-sm font-bold transition-all border-b-4 border-slate-200 bg-white text-slate-500 active:scale-95`;
        }
      });

      // Prepare Data
      let data = catId === 'semua' ? Object.values(SYLLABLE_DATA).flat() : (SYLLABLE_DATA[catId] || []);
      
      if (state.mode === 'learn') {
        // Learn Mode: Shuffle slightly but keep structure
        if(catId === 'semua') data = data.sort(() => Math.random() - 0.5);
        state.allCards = data;
        state.currentPage = 0;
        state.readCards.clear();
        renderLearnPage();
      } else {
        // Quiz Mode: Just reload the question based on new category
        window.nextQuizQuestion();
      }
    };

    // --- LEARN MODE LOGIC ---

    function renderLearnPage() {
      const ITEMS_PER_PAGE = 12;
      const start = state.currentPage * ITEMS_PER_PAGE;
      const end = start + ITEMS_PER_PAGE;
      state.currentCards = state.allCards.slice(start, end);

      const container = document.getElementById('cards-container');
      container.innerHTML = '';

      state.currentCards.forEach((item, idx) => {
        const isRead = state.readCards.has(item.text);
        const card = document.createElement('button');
        card.id = `learn-card-${idx}`;
        card.className = `relative aspect-square rounded-2xl flex flex-col items-center justify-center p-2 transition-all active:scale-95 btn-3d card-enter ${isRead ? 'card-read' : 'card-normal'}`;
        card.style.animationDelay = `${idx * 0.05}s`;
        card.onclick = () => playLearnCard(item, idx);
        
        card.innerHTML = `
          <div class="text-4xl mb-2 filter drop-shadow-sm">${item.emoji}</div>
          <div class="text-2xl md:text-3xl font-black text-slate-700">${item.text}</div>
          ${isRead ? '<div class="absolute top-2 right-2 text-green-600 text-lg">‚úì</div>' : ''}
        `;
        container.appendChild(card);
      });

      // Update Pagination UI
      const totalPages = Math.ceil(state.allCards.length / ITEMS_PER_PAGE);
      const pagControls = document.getElementById('pagination-controls');
      
      if (totalPages > 1) {
        pagControls.classList.remove('hidden');
        pagControls.children[0].disabled = state.currentPage === 0;
        pagControls.children[0].classList.toggle('opacity-50', state.currentPage === 0);
        pagControls.children[1].disabled = state.currentPage >= totalPages - 1;
        pagControls.children[1].classList.toggle('opacity-50', state.currentPage >= totalPages - 1);
      } else {
        pagControls.classList.add('hidden');
      }

      // Progress Bar
      const pageDone = state.currentCards.filter(c => state.readCards.has(c.text)).length;
      const pct = state.currentCards.length ? (pageDone / state.currentCards.length) * 100 : 0;
      document.getElementById('progress-bar').style.width = `${pct}%`;
      document.getElementById('progress-text').textContent = `${pageDone}/${state.currentCards.length}`;

      // Check Page Completion
      if (pageDone === state.currentCards.length && state.currentCards.length > 0) {
        setTimeout(() => showModal("Luar Biasa!", "Halaman ini selesai!"), 500);
      }
    }

    function playLearnCard(item, idx) {
      speak(item.text);
      
      // Visual Feedback
      const card = document.getElementById(`learn-card-${idx}`);
      if (!state.readCards.has(item.text)) {
        state.readCards.add(item.text);
        card.className = card.className.replace('card-normal', 'card-read');
        card.innerHTML += '<div class="absolute top-2 right-2 text-green-600 text-lg animate-bounce">‚úì</div>';
        
        // Update Progress
        const pageDone = state.currentCards.filter(c => state.readCards.has(c.text)).length;
        document.getElementById('progress-bar').style.width = `${(pageDone / state.currentCards.length) * 100}%`;
        document.getElementById('progress-text').textContent = `${pageDone}/${state.currentCards.length}`;
        
        playSound('ding');
        
        if (pageDone === state.currentCards.length) {
            setTimeout(() => showModal("Hore!", "Kamu menyelesaikan semua!"), 800);
        }
      }
    }

    window.changePage = function(delta) {
      state.currentPage += delta;
      state.readCards.clear(); // Reset stars for new page
      renderLearnPage();
      document.getElementById('scroll-area').scrollTop = 0;
    };

    window.shuffleAndReset = function() {
      state.allCards.sort(() => Math.random() - 0.5);
      state.readCards.clear();
      renderLearnPage();
    };

    window.resetCurrentPage = function() {
      state.readCards.clear();
      renderLearnPage();
    };

    // --- QUIZ MODE LOGIC ---

    window.nextQuizQuestion = function() {
      state.isQuizAnswered = false;
      document.getElementById('btn-next-quiz').classList.add('hidden');
      
      // 1. Get pool
      let pool = state.activeCategory === 'semua' ? Object.values(SYLLABLE_DATA).flat() : (SYLLABLE_DATA[state.activeCategory] || []);
      if (pool.length < 4) pool = Object.values(SYLLABLE_DATA).flat(); // Fallback if cat is too small
      
      // 2. Pick Target
      const target = pool[Math.floor(Math.random() * pool.length)];
      state.quizTarget = target;
      
      // 3. Pick 3 Distractors
      let options = [target];
      while (options.length < 4) {
        const d = pool[Math.floor(Math.random() * pool.length)];
        if (!options.some(o => o.text === d.text)) options.push(d);
      }
      options.sort(() => Math.random() - 0.5);

      // 4. Render Options
      const container = document.getElementById('quiz-options');
      container.innerHTML = options.map((item, idx) => `
        <button onclick="window.checkAnswer('${item.text}', this)" 
          class="aspect-square rounded-2xl flex flex-col items-center justify-center p-2 bg-white border-2 border-slate-200 border-b-[6px] transition-all active:scale-95 shadow-sm">
          <span class="text-4xl mb-1">${item.emoji}</span>
          <span class="text-3xl font-bold text-slate-700">${item.text}</span>
        </button>
      `).join('');

      // 5. Auto play sound after short delay
      setTimeout(() => speak(target.text), 300);
    };

    window.replayQuizSound = function() {
      if (state.quizTarget) speak(state.quizTarget.text);
    };

    window.checkAnswer = function(text, btnElement) {
      if (state.isQuizAnswered) return;

      if (text === state.quizTarget.text) {
        // CORRECT
        state.isQuizAnswered = true;
        playSound('win');
        btnElement.className = "aspect-square rounded-2xl flex flex-col items-center justify-center p-2 card-correct shadow-md";
        state.quizScore++;
        document.getElementById('quiz-score').textContent = state.quizScore;
        
        // Show Next Button
        document.getElementById('btn-next-quiz').classList.remove('hidden');
        
        // Confetti effect (simulated via modal for simplicity or just sound)
        
      } else {
        // WRONG
        playSound('wrong');
        btnElement.className = "aspect-square rounded-2xl flex flex-col items-center justify-center p-2 card-wrong";
        speak("bukan " + text);
        setTimeout(() => {
             if (!state.isQuizAnswered) btnElement.className = "aspect-square rounded-2xl flex flex-col items-center justify-center p-2 bg-white border-2 border-slate-200 border-b-[6px]";
        }, 500);
      }
    };


    // --- HELPERS ---

    function speak(text) {
      if ('speechSynthesis' in window) {
        speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(text);
        u.lang = 'id-ID';
        u.rate = 0.8;
        speechSynthesis.speak(u);
      }
    }

    function playSound(type) {
      if (!audioCtx) return;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.connect(gain);
      gain.connect(audioCtx.destination);

      if (type === 'ding') { // High ding
        osc.frequency.setValueAtTime(600, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
        osc.start(); osc.stop(audioCtx.currentTime + 0.5);
      } else if (type === 'win') { // Victory Upward
        osc.frequency.setValueAtTime(400, audioCtx.currentTime);
        osc.frequency.linearRampToValueAtTime(800, audioCtx.currentTime + 0.2);
        gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
        osc.start(); osc.stop(audioCtx.currentTime + 0.3);
      } else if (type === 'wrong') { // Low error
        osc.type = 'sawtooth';
        osc.frequency.setValueAtTime(150, audioCtx.currentTime);
        osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.2);
        gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
        osc.start(); osc.stop(audioCtx.currentTime + 0.3);
      }
    }

    function showModal(title, text) {
      document.getElementById('celebration').classList.remove('hidden');
      setTimeout(() => document.getElementById('celebration').classList.remove('opacity-0'), 10);
      document.querySelector('#celebration h2').textContent = title;
      document.getElementById('celebration-text').textContent = text;
      playSound('win');
    }

    window.closeCelebration = function() {
       document.getElementById('celebration').classList.add('opacity-0');
       setTimeout(() => document.getElementById('celebration').classList.add('hidden'), 300);
       
       if (state.mode === 'learn') {
           // Maybe move to next page?
       } else {
           window.nextQuizQuestion();
       }
    };

    // Run
    init();

  </script>
 </body>
</html>
